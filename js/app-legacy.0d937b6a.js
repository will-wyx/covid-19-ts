(function(){"use strict";var t={497:function(t,e,n){n(6992),n(8674),n(9601),n(7727);var a=n(9567),o=n(4549),i=n.n(o),r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"app",attrs:{id:"app"}},[n("peoples-tree",{ref:"tree",staticClass:"app__tree",attrs:{peoples:t.peoples,expanded:t.expanded,loading:t.loading,"max-index":t.maxIndex},on:{"update:maxIndex":function(e){t.maxIndex=e},"update:max-index":function(e){t.maxIndex=e},change:t.handleChange,click:t.handleNodeClick}}),n("div",{staticClass:"app__main"},[n("div",{staticClass:"app__filter"},[n("el-select",{staticClass:"app__filter__item",attrs:{multiple:"",placeholder:"请选择",size:"mini"},on:{change:t.filterPeoples},model:{value:t.areas,callback:function(e){t.areas=e},expression:"areas"}},t._l(t.options.areas,(function(e){return n("el-option",{key:e.value,staticClass:"app__option",attrs:{label:e.label,value:e.value}},[n("span",{staticClass:"app__option__label"},[t._v(t._s(e.label))]),n("span",{staticClass:"app__option__count"},[t._v(t._s(e.countQ)+"+"+t._s(e.countW))])])})),1),n("el-select",{staticClass:"app__filter__item",attrs:{multiple:"",placeholder:"请选择",size:"mini"},on:{change:t.filterPeoples},model:{value:t.dates,callback:function(e){t.dates=e},expression:"dates"}},t._l(t.options.dates,(function(e){return n("el-option",{key:e.value,staticClass:"app__option",attrs:{label:e.label,value:e.value}},[n("span",{staticClass:"app__option__label"},[t._v(t._s(e.label))]),n("span",{staticClass:"app__option__count"},[t._v(t._s(e.countQ)+"+"+t._s(e.countW))])])})),1),t._l(t.topPositions,(function(e){return n("el-tag",{key:e.rid,staticClass:"app__top__item",attrs:{size:"mini"}},[t._v(t._s(e.name)+"["+t._s(e.count)+"] ")])}))],2),n("a-map",{ref:"map",staticClass:"app__map",attrs:{points:t.points},on:{click:t.handleMarkerClick}})],1)],1)},c=[],l=n(3019),s=(n(7042),n(1539),n(1249),n(9826),n(2222),n(8783),n(3948),n(7327),n(4747),n(8309),n(8862),n(2707),n(4916),n(4765),function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"a-map"},[n("div",{ref:"amap",staticClass:"a-map__map"}),n("div",{ref:"marker",staticClass:"a-map__marker"},t._l(t.currentCluster,(function(e){return n("div",{key:e.id,staticClass:"a-map__marker__item"},[n("p",{staticClass:"marker__title"},[t._v(t._s(e.id))]),n("p",{staticClass:"marker__content"},[t._v(t._s(e.title))])])})),0)])}),u=[],d=n(8143),p=n(9648),f=n.n(p),h={name:"AMap",data:function(){return{map:null,cluster:null,AMap:null,geocoder:null,infoWindow:null,currentCluster:[]}},props:{points:{type:Array,default:function(){return[]}}},mounted:function(){this.initMap()},watch:{points:function(t){var e=this,n=[];t.forEach((function(t){t.location?n.push({id:t.id,title:t.origin,lnglat:[t.location.lng,t.location.lat]}):console.log(t.id,t.origin)})),this.cluster&&this.cluster.setMap(null),this.cluster=new this.AMap.MarkerCluster(this.map,n,{gridSize:60}),this.cluster.on("click",(function(t){var n=t.clusterData,a=t.lnglat,o=[];n.forEach((function(t){var e=t.id,n=t.title;o.push({id:e,title:n})})),e.currentCluster=o,e.infoWindow.open(e.map,a),e.$emit("click",o)})),this.map.setFitView(null,!0),this.infoWindow.close()}},methods:{initMap:function(){var t=this,e=this.$refs.amap;f().load({key:"d786ac93724ce3d6658748d66cf5be5b",version:"2.0",plugins:["AMap.MarkerCluster","AMap.Geocoder"]}).then((function(n){t.AMap=n;var a={city:"唐山市"};t.geocoder=new t.AMap.Geocoder(a),t.map=new n.Map(e,{viewMode:"2D",zoom:10,center:[118.144541,39.696604]}),t.map.on("rightclick",(function(e){var n=e.lnglat;t.geocoder.getAddress(n,(function(e,a){var o=a.regeocode.formattedAddress;t.geocoder.getLocation(o,(function(t,e){var a=(0,d.Z)(e.geocodes,1),i=a[0].location,r=i.lng,c=i.lat;console.log(o,{lng:n.lng,lat:n.lat},JSON.stringify({location:{lng:r,lat:c}}))}))}))}));var o=t.$refs.marker;t.infoWindow=new n.InfoWindow({anchor:"top-left",content:o})})).catch((function(t){console.log(t)}))},setCenter:function(t){var e=t.location;this.map.setZoomAndCenter(17,[e.lng,e.lat],!0)}}},m=h,v=n(1001),_=(0,v.Z)(m,s,u,!1,null,"670dbde9",null),g=_.exports,C=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("el-tree",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"tree",staticClass:"peoples-tree",attrs:{"node-key":"id","default-expanded-keys":t.expanded,"show-checkbox":"",data:t.treeData,props:t.defaultProps},on:{check:t.handleCheck,"node-click":t.handleClick,"node-contextmenu":t.handleContextmenu},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.node,o=e.data;return n("span",{staticClass:"peoples-tree__label",class:{accurate0:3===a.level&&!o.accurate,accurate1:3===a.level&&1===o.accurate,accurate2:3===a.level&&2===o.accurate}},[t._v(" "+t._s(o.label)+" "),o.date?n("span",{staticClass:"peoples-tree__date"},[t._v(t._s(o.date))]):t._e()])}}])})},k=[],b=(n(9653),{name:"PeoplesTree",data:function(){return{data:[],defaultProps:{label:"label",children:"children"}}},props:{peoples:{type:Array,default:function(){return[]}},loading:{type:Boolean,default:!1},expanded:{type:Array,default:function(){return[]}},maxIndex:{type:Number,default:0}},computed:{treeData:function(){var t=[],e=[];return this.peoples.forEach((function(n){var a,o=n.id.slice(0,1),i=n.id.slice(1);a="Q"===o?t:e;var r=n.track.map((function(t){return(0,l.Z)({label:t.origin||t.name},t)}));a.push({id:n.id,no:+i,label:"".concat(i," ").concat(n.area," (").concat(r.length,")"),date:n.date,children:r})})),t.sort((function(t,e){return t.no-e.no})),e.sort((function(t,e){return t.no-e.no})),[{id:"Q",label:"确诊 [".concat(t.length,"]"),children:t},{id:"W",label:"无症状 [".concat(e.length,"]"),children:e}]}},methods:{handleCheck:function(t,e){var n=e.checkedNodes,a=n.filter((function(t){return!t.children}));this.$emit("change",a)},handleClick:function(t){t.location&&this.$emit("click",t)},handleContextmenu:function(t,e){if(e.location){var n=this.maxIndex+1;this.$emit("update:maxIndex",n);var a=JSON.stringify({rid:n,district:e.district,name:e.name,location:e.location});console.log(a)}},checkAreas:function(t){var e=[];this.peoples.forEach((function(n){t.some((function(t){return t===n.area}))&&e.push(n.id)}));var n=this.$refs.tree;n.setCheckedKeys(e);var a=n.getCheckedNodes();this.handleCheck(null,{checkedNodes:a})}}}),x=b,y=(0,v.Z)(x,C,k,!1,null,"ddd52f28",null),w=y.exports,M=n(6166),A=n.n(M),P=A().create({timeout:3e5}),O=P,W={name:"App",components:{PeoplesTree:w,AMap:g},data:function(){return{allPeoples:[],peoples:[],points:[],AMap:null,autoComplete:null,loading:!1,expanded:["Q","W"],maxIndex:0,options:{areas:[],dates:[]},areas:[],dates:[],positions:[],top:20}},computed:{topPositions:function(){return this.positions.slice(0,this.top)}},created:function(){var t=this;f().load({key:"d786ac93724ce3d6658748d66cf5be5b",version:"2.0",plugins:["AMap.AutoComplete"]}).then((function(e){t.AMap=e,t.loadData();var n={city:"唐山市"};t.autoComplete=new t.AMap.AutoComplete(n)})).catch((function(t){console.log(t)}))},methods:{loadData:function(){var t=this;this.loading=!0,O.get("data/data.json").then((function(e){var n=e.data,a=[];t.positions=n.positions,t.maxIndex=t.positions.reduce((function(t,e){return t.rid>e.rid?t.rid:e.rid}));var o=n.peoples.map((function(e){var n=e.id.slice(0,1),o=t.options.areas.find((function(t){return t.value===e.area}));o?o["count".concat(n)]++:(o={value:e.area,label:e.area,checked:!0,countQ:0,countW:0},o["count".concat(n)]=1,t.options.areas.push(o)),o.label="".concat(o.value," [").concat(o.countQ,"+").concat(o.countW,"]");var i=t.options.dates.find((function(t){return t.value===e.date}));i?i["count".concat(n)]++:(i={value:e.date,label:e.date.slice(5),checked:!0,countQ:0,countW:0},i["count".concat(n)]=1,t.options.dates.push(i)),i.label="".concat(i.value," [").concat(i.countQ,"+").concat(i.countW,"]");var r=e.track.map((function(n,o){var i;if(n.rid){var r=t.positions.find((function(t){return t.rid===n.rid}));r.count?r.count++:r.count=1,i=(0,l.Z)((0,l.Z)({},n),r)}else i=(0,l.Z)({},n),0!==n.accurate&&a.push(t.searchPoint(i,e));return i.id="".concat(e.id,"-").concat(o),i}));return(0,l.Z)((0,l.Z)({},e),{},{track:r})}));t.areas=t.options.areas.map((function(t){return t.value})),t.dates=t.options.dates.map((function(t){return t.value})),Promise.all(a).then((function(e){t.searchCallback(e,o)})).catch((function(t){console.log("err",t)}))}))},handleChange:function(t){this.points=t},handleNodeClick:function(t){this.$refs.map.setCenter(t)},handleMarkerClick:function(t){var e=t.map((function(t){return t.id.slice(0,5)}));this.expanded=e},filterPeoples:function(){var t=this;this.peoples=this.allPeoples.filter((function(e){var n=e.date,a=e.area,o=t.dates.some((function(t){return t===n})),i=t.areas.some((function(t){return t===a}));return o&&i}))},searchCallback:function(t,e){var n=[],a=[];t.forEach((function(t){var e=t.data,o=t.pos,i=t.people;e.district=o.district,e.name=o.name,e.location=o.location,e.accurate=o.accurate,o.rid&&(n.push([i.id,JSON.stringify({rid:o.rid,accurate:1,origin:e.origin}),e.name]),-1===o.accurate&&a.push({rid:o.rid,district:o.district,name:o.name,location:o.location}))})),console.table(n),console.log(a),this.allPeoples=e,this.peoples=e,this.loading=!1,this.positions.sort((function(t,e){return e.count>t.count?1:-1})),console.table(this.positions.slice(0,2*this.top).map((function(t){var e=t.district,n=t.name,a=t.count;return{district:e,name:n,count:a}})))},searchPoint:function(t,e){var n=this;return new Promise((function(a,o){n.autoComplete.search(t.origin,(function(i,r){if(r){var c={accurate:0};if("OK"===r.info){var s=r.tips[0],u=s.district,d=s.name,p=s.location;c={district:u,name:d,location:{lng:p.lng,lat:p.lat},accurate:1};var f=n.positions.find((function(t){var e=t.location,n=e.lng,a=e.lat;return n===c.location.lng&&a===c.location.lat}));f?(c.rid=f.rid,f.count?f.count++:f.count=0):(c.rid=++n.maxIndex,c.accurate=-1,n.positions.push((0,l.Z)((0,l.Z)({},c),{},{count:1})))}a({data:t,pos:c,people:e})}else o({status:i,result:r,origin:t.origin})}))}))}}},Z=W,$=(0,v.Z)(Z,r,c,!1,null,null,null),I=$.exports;window._AMapSecurityConfig={securityJsCode:"30eb50807133bec74365efaac53b226a"},a["default"].use(i()),a["default"].config.productionTip=!1,new a["default"]({render:function(t){return t(I)}}).$mount("#app")}},e={};function n(a){var o=e[a];if(void 0!==o)return o.exports;var i=e[a]={exports:{}};return t[a].call(i.exports,i,i.exports,n),i.exports}n.m=t,function(){var t=[];n.O=function(e,a,o,i){if(!a){var r=1/0;for(u=0;u<t.length;u++){a=t[u][0],o=t[u][1],i=t[u][2];for(var c=!0,l=0;l<a.length;l++)(!1&i||r>=i)&&Object.keys(n.O).every((function(t){return n.O[t](a[l])}))?a.splice(l--,1):(c=!1,i<r&&(r=i));if(c){t.splice(u--,1);var s=o();void 0!==s&&(e=s)}}return e}i=i||0;for(var u=t.length;u>0&&t[u-1][2]>i;u--)t[u]=t[u-1];t[u]=[a,o,i]}}(),function(){n.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return n.d(e,{a:e}),e}}(),function(){n.d=function(t,e){for(var a in e)n.o(e,a)&&!n.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:e[a]})}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){n.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}}(),function(){var t={143:0};n.O.j=function(e){return 0===t[e]};var e=function(e,a){var o,i,r=a[0],c=a[1],l=a[2],s=0;if(r.some((function(e){return 0!==t[e]}))){for(o in c)n.o(c,o)&&(n.m[o]=c[o]);if(l)var u=l(n)}for(e&&e(a);s<r.length;s++)i=r[s],n.o(t,i)&&t[i]&&t[i][0](),t[i]=0;return n.O(u)},a=self["webpackChunkcovid_19_ts"]=self["webpackChunkcovid_19_ts"]||[];a.forEach(e.bind(null,0)),a.push=e.bind(null,a.push.bind(a))}();var a=n.O(void 0,[998],(function(){return n(497)}));a=n.O(a)})();
//# sourceMappingURL=app-legacy.0d937b6a.js.map
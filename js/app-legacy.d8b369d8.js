(function(){"use strict";var e={9605:function(e,t,n){n(6992),n(8674),n(9601),n(7727);var a=n(9567),o=n(4549),i=n.n(o),r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"app",attrs:{id:"app"}},[n("peoples-tree",{ref:"tree",staticClass:"app__tree",attrs:{peoples:e.peoples,expanded:e.expanded,loading:e.loading,"max-index":e.maxIndex},on:{"update:maxIndex":function(t){e.maxIndex=t},"update:max-index":function(t){e.maxIndex=t},change:e.handleChange,click:e.handleNodeClick}}),n("div",{staticClass:"app__main"},[n("div",{staticClass:"app__filter"},[n("el-select",{staticClass:"app__filter__item",attrs:{multiple:"",placeholder:"请选择",size:"mini"},on:{change:e.filterPeoples},model:{value:e.areas,callback:function(t){e.areas=t},expression:"areas"}},e._l(e.options.areas,(function(t){return n("el-option",{key:t.value,staticClass:"app__option",attrs:{label:t.label,value:t.value}},[n("span",{staticClass:"app__option__label"},[e._v(e._s(t.label))]),n("span",{staticClass:"app__option__count"},[e._v(e._s(t.countQ)+"+"+e._s(t.countW))])])})),1),n("el-select",{staticClass:"app__filter__item",attrs:{multiple:"",placeholder:"请选择",size:"mini"},on:{change:e.filterPeoples},model:{value:e.dates,callback:function(t){e.dates=t},expression:"dates"}},e._l(e.options.dates,(function(t){return n("el-option",{key:t.value,staticClass:"app__option",attrs:{label:t.label,value:t.value}},[n("span",{staticClass:"app__option__label"},[e._v(e._s(t.label))]),n("span",{staticClass:"app__option__count"},[e._v(e._s(t.countQ)+"+"+e._s(t.countW))])])})),1),e._l(e.topPositions,(function(t){return n("el-tag",{key:t.rid,staticClass:"app__top__item",attrs:{size:"mini"},on:{click:function(n){return e.handleTagClick(t)}}},[e._v(e._s(t.name)+"["+e._s(t.count)+"] ")])}))],2),n("a-map",{ref:"map",staticClass:"app__map",attrs:{points:e.points},on:{click:e.handleMarkerClick,"marker-item-click":e.handleMarkerItemClick}})],1)],1)},c=[],l=n(3019),s=(n(7042),n(1539),n(1249),n(9826),n(2222),n(8783),n(3948),n(4747),n(7327),n(8309),n(8862),n(2707),n(4916),n(4765),function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"a-map"},[n("div",{ref:"amap",staticClass:"a-map__map"}),n("div",{ref:"marker",staticClass:"a-map__marker"},e._l(e.currentCluster,(function(t,a){return n("div",{key:a,staticClass:"a-map__marker__item",on:{click:function(n){return e.handleMarkerItemClick(t)}}},[n("p",{staticClass:"marker__title"},[e._v(e._s(t.id))]),n("p",{staticClass:"marker__content"},[e._v(e._s(t.title))])])})),0),n("div",{staticClass:"a-map__complete"},[n("el-select",{staticClass:"complete__control",attrs:{filterable:"",remote:"","reserve-keyword":"",placeholder:"请输入关键词","remote-method":e.searchAddress,loading:e.loading,size:"mini"},on:{change:e.handleCompleteChange},model:{value:e.address,callback:function(t){e.address=t},expression:"address"}},e._l(e.options,(function(e,t){return n("el-option",{key:t,attrs:{label:e.label,value:e.value}})})),1)],1)])}),u=[],d=n(8143),p=n(9648),f=n.n(p),h={name:"AMap",data:function(){return{map:null,cluster:null,AMap:null,geocoder:null,autoComplete:null,infoWindow:null,currentCluster:[],address:null,loading:!1,options:[]}},props:{points:{type:Array,default:function(){return[]}}},mounted:function(){this.initMap()},watch:{points:function(e){var t=this,n=[];e.forEach((function(e){e.location?n.push({id:e.id,title:e.origin,lnglat:[e.location.lng,e.location.lat]}):console.log(e.id,e.origin)})),this.cluster&&this.cluster.setMap(null),this.cluster=new this.AMap.MarkerCluster(this.map,n,{gridSize:60}),this.cluster.on("click",(function(e){var n=e.clusterData,a=e.lnglat,o=[];n.forEach((function(e){var t=e.id,n=e.title;o.push({id:t.slice(0,5),title:n})})),t.currentCluster=o,t.infoWindow.open(t.map,a),t.$emit("click",o)})),this.map.setFitView(null,!0),this.infoWindow.close()}},methods:{initMap:function(){var e=this,t=this.$refs.amap;f().load({key:"d786ac93724ce3d6658748d66cf5be5b",version:"2.0",plugins:["AMap.MarkerCluster","AMap.Geocoder","AMap.AutoComplete"]}).then((function(n){e.AMap=n;var a={city:"唐山市"};e.geocoder=new e.AMap.Geocoder(a),e.autoComplete=new e.AMap.AutoComplete(a),e.map=new n.Map(t,{viewMode:"2D",zoom:10,center:[118.144541,39.696604]}),e.map.on("rightclick",(function(t){var n=t.lnglat;e.geocoder.getAddress(n,(function(t,a){var o=a.regeocode.formattedAddress;e.geocoder.getLocation(o,(function(e,t){var a=(0,d.Z)(t.geocodes,1),i=a[0].location,r=i.lng,c=i.lat;console.log("%s\n%s\n%s",JSON.stringify({lng:n.lng,lat:n.lat}),JSON.stringify({lng:r,lat:c}),o)}))}))}));var o=e.$refs.marker;e.infoWindow=new n.InfoWindow({anchor:"top-left",content:o})})).catch((function(e){console.log(e)}))},searchAddress:function(e){var t=this;""!==e?(this.loading=!0,this.autoComplete.search(e,(function(e,n){n&&(t.options=n.tips.map((function(e){var t=e.id,n=e.district,a=e.name,o=e.location,i=e.address;return{value:t,label:"".concat(a),location:o,district:n,address:i}})),t.loading=!1)}))):this.options=[]},setCenter:function(e){var t=e.location;this.map.setZoomAndCenter(17,[t.lng,t.lat],!0)},handleMarkerItemClick:function(e){this.$emit("marker-item-click",e.id)},handleCompleteChange:function(e){var t=this.options.find((function(t){return t.value===e})),n=t.location,a=n.lng,o=n.lat;console.log(JSON.stringify({lng:a,lat:o})),this.setCenter(t)}}},m=h,v=n(1001),_=(0,v.Z)(m,s,u,!1,null,"0ac1798f",null),g=_.exports,k=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-tree",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"tree",staticClass:"peoples-tree",attrs:{"node-key":"id","default-expanded-keys":e.expanded,"show-checkbox":"",data:e.treeData,props:e.defaultProps},on:{check:e.handleCheck,"node-click":e.handleClick,"node-contextmenu":e.handleContextmenu},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.node,o=t.data;return n("span",{staticClass:"peoples-tree__label",class:{accurate0:3===a.level&&!o.accurate,accurate1:3===a.level&&1===o.accurate,accurate2:3===a.level&&2===o.accurate}},[e._v(" "+e._s(o.label)+" "),o.date?n("span",{staticClass:"peoples-tree__date"},[e._v(e._s(o.date))]):e._e()])}}])})},C=[],b=(n(9653),{name:"PeoplesTree",data:function(){return{data:[],defaultProps:{label:"label",children:"children"}}},props:{peoples:{type:Array,default:function(){return[]}},loading:{type:Boolean,default:!1},expanded:{type:Array,default:function(){return[]}},maxIndex:{type:Number,default:0}},computed:{treeData:function(){var e=[],t=[];return this.peoples.forEach((function(n){var a,o=n.id.slice(0,1),i=n.id.slice(1);a="Q"===o?e:t;var r=n.track.map((function(e){return(0,l.Z)({label:e.origin||e.name},e)}));a.push({id:n.id,no:+i,label:"".concat(i," ").concat(n.area," (").concat(r.length,")"),date:n.date,children:r})})),e.sort((function(e,t){return e.no-t.no})),t.sort((function(e,t){return e.no-t.no})),[{id:"Q",label:"确诊 [".concat(e.length,"]"),children:e},{id:"W",label:"无症状 [".concat(t.length,"]"),children:t}]}},methods:{handleCheck:function(e,t){var n=t.checkedNodes,a=n.filter((function(e){return!e.children}));this.$emit("change",a)},handleClick:function(e){e.location&&this.$emit("click",e)},handleContextmenu:function(e,t){if(t.location){var n=this.maxIndex+1;this.$emit("update:maxIndex",n);var a=JSON.stringify({rid:n,district:t.district,name:t.name,location:t.location});console.log(a)}},checkKeys:function(e){var t=this.$refs.tree;t.setCheckedKeys(e);var n=t.getCheckedNodes();this.handleCheck(null,{checkedNodes:n})}}}),x=b,y=(0,v.Z)(x,k,C,!1,null,"1f8d7e99",null),M=y.exports,w=n(6166),A=n.n(w),P=A().create({timeout:3e5}),O=P,I={name:"App",components:{PeoplesTree:M,AMap:g},data:function(){return{allPeoples:[],peoples:[],points:[],AMap:null,autoComplete:null,loading:!1,expanded:["Q","W"],maxIndex:0,options:{areas:[],dates:[]},areas:[],dates:[],positions:[],top:20}},computed:{topPositions:function(){return this.positions.slice(0,this.top)}},created:function(){var e=this;f().load({key:"d786ac93724ce3d6658748d66cf5be5b",version:"2.0",plugins:["AMap.AutoComplete"]}).then((function(t){e.AMap=t,e.loadData();var n={city:"唐山市"};e.autoComplete=new e.AMap.AutoComplete(n)})).catch((function(e){console.log(e)}))},methods:{loadData:function(){var e=this;this.loading=!0,O.get("data/data.json").then((function(t){var n=t.data,a=[];e.positions=n.positions,e.maxIndex=e.positions.reduce((function(e,t){return e.rid>t.rid?e.rid:t.rid}));var o=n.peoples.map((function(t){var n=t.id.slice(0,1),o=e.options.areas.find((function(e){return e.value===t.area}));o?o["count".concat(n)]++:(o={value:t.area,label:t.area,checked:!0,countQ:0,countW:0},o["count".concat(n)]=1,e.options.areas.push(o)),o.label="".concat(o.value," [").concat(o.countQ,"+").concat(o.countW,"]");var i=e.options.dates.find((function(e){return e.value===t.date}));i?i["count".concat(n)]++:(i={value:t.date,label:t.date.slice(5),checked:!0,countQ:0,countW:0},i["count".concat(n)]=1,e.options.dates.push(i)),i.label="".concat(i.value," [").concat(i.countQ,"+").concat(i.countW,"]");var r=t.track.map((function(n,o){var i;if(n.rid){var r=e.positions.find((function(e){return e.rid===n.rid}));r.count?r.count++:r.count=1,i=(0,l.Z)((0,l.Z)({},n),r)}else i=(0,l.Z)({},n),0!==n.accurate&&a.push(e.searchPoint(i,t));return i.id="".concat(t.id,"-").concat(o),i}));return(0,l.Z)((0,l.Z)({},t),{},{track:r})}));e.areas=e.options.areas.map((function(e){return e.value})),e.dates=e.options.dates.map((function(e){return e.value})),Promise.all(a).then((function(t){e.searchCallback(t,o)})).catch((function(e){console.log("err",e)}))}))},handleChange:function(e){this.points=e},handleNodeClick:function(e){this.$refs.map.setCenter(e)},handleMarkerClick:function(e){var t=e.map((function(e){return e.id.slice(0,5)}));this.expanded=t},handleMarkerItemClick:function(e){var t=this.peoples.find((function(t){return t.id===e})),n=t.track;console.table(n.map((function(e){var t=e.id,n=e.origin;return{id:t,origin:n}})))},handleTagClick:function(e){var t=e.rid,n=[];this.peoples.forEach((function(e){var a=e.track;a.forEach((function(e){e.rid===t&&n.push(e.id)}))})),this.$refs.tree.checkKeys(n)},filterPeoples:function(){var e=this;this.peoples=this.allPeoples.filter((function(t){var n=t.date,a=t.area,o=e.dates.some((function(e){return e===n})),i=e.areas.some((function(e){return e===a}));return o&&i}))},searchCallback:function(e,t){var n=[],a=[];e.forEach((function(e){var t=e.data,o=e.pos,i=e.people;t.district=o.district,t.name=o.name,t.location=o.location,t.accurate=o.accurate,o.rid&&(n.push([i.id,JSON.stringify({rid:o.rid,accurate:1,origin:t.origin}),t.name]),-1===o.accurate&&a.push({rid:o.rid,district:o.district,name:o.name,location:o.location}))})),console.table(n),console.log(a),this.allPeoples=t,this.peoples=t,this.loading=!1,this.positions.sort((function(e,t){return t.count>e.count?1:-1})),console.table(this.positions.slice(0,2*this.top).map((function(e){var t=e.district,n=e.name,a=e.count;return{district:t,name:n,count:a}})))},searchPoint:function(e,t){var n=this;return new Promise((function(a,o){n.autoComplete.search(e.origin,(function(i,r){if(r){var c={accurate:0};if("OK"===r.info){var s=r.tips[0],u=s.district,d=s.name,p=s.location;c={district:u,name:d,location:{lng:p.lng,lat:p.lat},accurate:1};var f=n.positions.find((function(e){var t=e.location,n=t.lng,a=t.lat;return n===c.location.lng&&a===c.location.lat}));f?(c.rid=f.rid,f.count?f.count++:f.count=0):(c.rid=++n.maxIndex,c.accurate=-1,n.positions.push((0,l.Z)((0,l.Z)({},c),{},{count:1})))}a({data:e,pos:c,people:t})}else o({status:i,result:r,origin:e.origin})}))}))}}},$=I,S=(0,v.Z)($,r,c,!1,null,null,null),W=S.exports;window._AMapSecurityConfig={securityJsCode:"30eb50807133bec74365efaac53b226a"},a["default"].use(i()),a["default"].config.productionTip=!1,new a["default"]({render:function(e){return e(W)}}).$mount("#app")}},t={};function n(a){var o=t[a];if(void 0!==o)return o.exports;var i=t[a]={exports:{}};return e[a].call(i.exports,i,i.exports,n),i.exports}n.m=e,function(){var e=[];n.O=function(t,a,o,i){if(!a){var r=1/0;for(u=0;u<e.length;u++){a=e[u][0],o=e[u][1],i=e[u][2];for(var c=!0,l=0;l<a.length;l++)(!1&i||r>=i)&&Object.keys(n.O).every((function(e){return n.O[e](a[l])}))?a.splice(l--,1):(c=!1,i<r&&(r=i));if(c){e.splice(u--,1);var s=o();void 0!==s&&(t=s)}}return t}i=i||0;for(var u=e.length;u>0&&e[u-1][2]>i;u--)e[u]=e[u-1];e[u]=[a,o,i]}}(),function(){n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,{a:t}),t}}(),function(){n.d=function(e,t){for(var a in t)n.o(t,a)&&!n.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={143:0};n.O.j=function(t){return 0===e[t]};var t=function(t,a){var o,i,r=a[0],c=a[1],l=a[2],s=0;if(r.some((function(t){return 0!==e[t]}))){for(o in c)n.o(c,o)&&(n.m[o]=c[o]);if(l)var u=l(n)}for(t&&t(a);s<r.length;s++)i=r[s],n.o(e,i)&&e[i]&&e[i][0](),e[i]=0;return n.O(u)},a=self["webpackChunkcovid_19_ts"]=self["webpackChunkcovid_19_ts"]||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))}();var a=n.O(void 0,[998],(function(){return n(9605)}));a=n.O(a)})();
//# sourceMappingURL=app-legacy.d8b369d8.js.map
(function(){"use strict";var e={9746:function(e,t,a){var n=a(8935),o=a(4549),s=a.n(o),i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app",attrs:{id:"app"}},[a("peoples-tree",{ref:"tree",staticClass:"app__tree",attrs:{peoples:e.peoples,expanded:e.expanded,loading:e.loading,"max-index":e.maxIndex},on:{change:e.handleChange,click:e.handleNodeClick}}),a("div",{staticClass:"app__main"},[a("div",{staticClass:"app__filter"},[a("el-select",{staticClass:"app__filter__item",attrs:{multiple:"",placeholder:"请选择",size:"mini"},on:{change:e.filterPeoples},model:{value:e.areas,callback:function(t){e.areas=t},expression:"areas"}},e._l(e.options.areas,(function(t){return a("el-option",{key:t.value,staticClass:"app__option",attrs:{label:t.label,value:t.value}},[a("span",{staticClass:"app__option__label"},[e._v(e._s(t.label))]),a("span",{staticClass:"app__option__count"},[e._v(e._s(t.countQ)+"+"+e._s(t.countW))])])})),1),a("el-select",{staticClass:"app__filter__item",attrs:{multiple:"",placeholder:"请选择",size:"mini"},on:{change:e.filterPeoples},model:{value:e.dates,callback:function(t){e.dates=t},expression:"dates"}},e._l(e.options.dates,(function(t){return a("el-option",{key:t.value,staticClass:"app__option",attrs:{label:t.label,value:t.value}},[a("span",{staticClass:"app__option__label"},[e._v(e._s(t.label))]),a("span",{staticClass:"app__option__count"},[e._v(e._s(t.countQ)+"+"+e._s(t.countW))])])})),1)],1),a("a-map",{ref:"map",staticClass:"app__map",attrs:{points:e.points},on:{click:e.handleMarkerClick}})],1)],1)},l=[],r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"a-map"},[a("div",{ref:"amap",staticClass:"a-map__map"}),a("div",{ref:"marker",staticClass:"a-map__marker"},e._l(e.currentCluster,(function(t){return a("div",{key:t.id,staticClass:"a-map__marker__item"},[a("p",{staticClass:"marker__title"},[e._v(e._s(t.id))]),a("p",{staticClass:"marker__content"},[e._v(e._s(t.title))])])})),0)])},c=[],d=a(9648),p=a.n(d),u={name:"AMap",data(){return{map:null,cluster:null,AMap:null,geocoder:null,infoWindow:null,currentCluster:[]}},props:{points:{type:Array,default:()=>[]}},mounted(){this.initMap()},watch:{points(e){const t=[];e.forEach((e=>{e.location?t.push({id:e.id,title:e.origin,lnglat:[e.location.lng,e.location.lat]}):console.log(e.id,e.origin)})),this.cluster&&this.cluster.setMap(null),this.cluster=new this.AMap.MarkerCluster(this.map,t,{gridSize:60}),this.cluster.on("click",(({clusterData:e,lnglat:t})=>{const a=[];e.forEach((e=>{const{id:t,title:n}=e;a.push({id:t,title:n})})),this.currentCluster=a,this.infoWindow.open(this.map,t),this.$emit("click",a)})),this.map.setFitView(null,!0),this.infoWindow.close()}},methods:{initMap(){const e=this.$refs.amap;p().load({key:"d786ac93724ce3d6658748d66cf5be5b",version:"2.0",plugins:["AMap.MarkerCluster","AMap.Geocoder"]}).then((t=>{this.AMap=t;const a={city:"唐山市"};this.geocoder=new this.AMap.Geocoder(a),this.map=new t.Map(e,{viewMode:"2D",zoom:10,center:[118.144541,39.696604]}),this.map.on("rightclick",(({lnglat:e})=>{this.geocoder.getAddress(e,((e,t)=>{const{regeocode:{formattedAddress:a}}=t;this.geocoder.getLocation(a,((e,t)=>{const[{location:{lng:a,lat:n}}]=t.geocodes;console.log(JSON.stringify({location:{lng:a,lat:n}}))}))}))}));const n=this.$refs.marker;this.infoWindow=new t.InfoWindow({anchor:"top-left",content:n})})).catch((e=>{console.log(e)}))},setCenter({location:e}){this.map.setZoomAndCenter(17,[e.lng,e.lat],!0)}}},h=u,f=a(3736),m=(0,f.Z)(h,r,c,!1,null,"2f221282",null),_=m.exports,g=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-tree",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"tree",staticClass:"peoples-tree",attrs:{"node-key":"id","default-expanded-keys":e.expanded,"show-checkbox":"",data:e.treeData,props:e.defaultProps},on:{check:e.handleCheck,"node-click":e.handleClick,"node-contextmenu":e.handleContextmenu},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.node,o=t.data;return a("span",{staticClass:"peoples-tree__label",class:{accurate0:3===n.level&&!o.accurate,accurate1:3===n.level&&1===o.accurate,accurate2:3===n.level&&2===o.accurate}},[e._v(" "+e._s(o.label)+" "),o.date?a("span",{staticClass:"peoples-tree__date"},[e._v(e._s(o.date))]):e._e()])}}])})},v=[],C={name:"PeoplesTree",data(){return{data:[],defaultProps:{label:"label",children:"children"},rid:0}},props:{peoples:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1},expanded:{type:Array,default:()=>[]},maxIndex:{type:Number,default:0}},computed:{treeData(){const e=[],t=[];return this.peoples.forEach((a=>{const n=a.id.slice(0,1),o=a.id.slice(1);let s;s="Q"===n?e:t;const i=a.track.map((e=>({label:e.origin||e.name,...e})));s.push({id:a.id,no:+o,label:`${o} ${a.area} (${i.length})`,date:a.date,children:i})})),e.sort(((e,t)=>e.no-t.no)),t.sort(((e,t)=>e.no-t.no)),[{id:"Q",label:`确诊 [${e.length}]`,children:e},{id:"W",label:`无症状 [${t.length}]`,children:t}]}},watch:{maxIndex(e){this.rid=e}},methods:{handleCheck(e,{checkedNodes:t}){const a=t.filter((e=>!e.children));this.$emit("change",a)},handleClick(e){e.location&&this.$emit("click",e)},handleContextmenu(e,t){if(t.location){const e=JSON.stringify({rid:++this.rid,district:t.district,name:t.name,location:t.location});console.log(e)}},checkAreas(e){const t=[];this.peoples.forEach((a=>{e.some((e=>e===a.area))&&t.push(a.id)}));const a=this.$refs.tree;a.setCheckedKeys(t);const n=a.getCheckedNodes();this.handleCheck(null,{checkedNodes:n})}}},k=C,b=(0,f.Z)(k,g,v,!1,null,"2fdc2361",null),y=b.exports,x=a(6166),w=a.n(x);const $=w().create({timeout:3e5});var M=$,A={name:"App",components:{PeoplesTree:y,AMap:_},data(){return{allPeoples:[],peoples:[],points:[],AMap:null,autoComplete:null,loading:!1,expanded:["Q","W"],maxIndex:0,options:{areas:[],dates:[]},areas:[],dates:[]}},created(){p().load({key:"d786ac93724ce3d6658748d66cf5be5b",version:"2.0",plugins:["AMap.AutoComplete"]}).then((e=>{this.AMap=e,this.loadData();const t={city:"唐山市"};this.autoComplete=new this.AMap.AutoComplete(t)})).catch((e=>{console.log(e)}))},methods:{loadData(){this.loading=!0,M.get("data/data.json").then((({data:e})=>{const t=[];this.maxIndex=e.positions.reduce(((e,t)=>e.rid>t.rid?e.rid:t.rid));const a=e.peoples.map((a=>{const n=a.id.slice(0,1);let o=this.options.areas.find((e=>e.value===a.area));o?o[`count${n}`]++:(o={value:a.area,label:a.area,checked:!0,countQ:0,countW:0},o[`count${n}`]=1,this.options.areas.push(o)),o.label=`${o.value} [${o.countQ}+${o.countW}]`;let s=this.options.dates.find((e=>e.value===a.date));s?s[`count${n}`]++:(s={value:a.date,label:a.date.slice(5),checked:!0,countQ:0,countW:0},s[`count${n}`]=1,this.options.dates.push(s)),s.label=`${s.value} [${s.countQ}+${s.countW}]`;const i=a.track.map(((n,o)=>{let s;return n.rid?s={...n,...e.positions.find((e=>e.rid===n.rid))}:(s={...n},0!==n.accurate&&t.push(this.searchPoint(s))),s.id=`${a.id}-${o}`,s}));return{...a,track:i}}));this.areas=this.options.areas.map((e=>e.value)),this.dates=this.options.dates.map((e=>e.value)),Promise.all(t).then((e=>{e.forEach((({data:e,pos:t})=>{e.district=t.district,e.name=t.name,e.location=t.location,e.accurate=t.accurate})),this.allPeoples=a,this.peoples=a,this.loading=!1})).catch((e=>{console.log("err",e)}))}))},handleChange(e){this.points=e},handleNodeClick(e){this.$refs.map.setCenter(e)},handleMarkerClick(e){const t=e.map((e=>e.id.slice(0,5)));this.expanded=t},filterPeoples(){this.peoples=this.allPeoples.filter((e=>{const{date:t,area:a}=e,n=this.dates.some((e=>e===t)),o=this.areas.some((e=>e===a));return n&&o}))},searchPoint(e){return new Promise(((t,a)=>{this.autoComplete.search(e.origin,((n,o)=>{if(o){let a;if("OK"===o.info){const{district:e,name:t,location:n}=o.tips[0];a={district:e,name:t,location:{lng:n.lng,lat:n.lat},accurate:1}}else a={accurate:0};t({data:e,pos:a})}else a({status:n,result:o,origin:e.origin})}))}))}}},P=A,O=(0,f.Z)(P,i,l,!1,null,null,null),W=O.exports;window._AMapSecurityConfig={securityJsCode:"30eb50807133bec74365efaac53b226a"},n["default"].use(s()),n["default"].config.productionTip=!1,new n["default"]({render:e=>e(W)}).$mount("#app")}},t={};function a(n){var o=t[n];if(void 0!==o)return o.exports;var s=t[n]={exports:{}};return e[n].call(s.exports,s,s.exports,a),s.exports}a.m=e,function(){var e=[];a.O=function(t,n,o,s){if(!n){var i=1/0;for(d=0;d<e.length;d++){n=e[d][0],o=e[d][1],s=e[d][2];for(var l=!0,r=0;r<n.length;r++)(!1&s||i>=s)&&Object.keys(a.O).every((function(e){return a.O[e](n[r])}))?n.splice(r--,1):(l=!1,s<i&&(i=s));if(l){e.splice(d--,1);var c=o();void 0!==c&&(t=c)}}return t}s=s||0;for(var d=e.length;d>0&&e[d-1][2]>s;d--)e[d]=e[d-1];e[d]=[n,o,s]}}(),function(){a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,{a:t}),t}}(),function(){a.d=function(e,t){for(var n in t)a.o(t,n)&&!a.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}}(),function(){a.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={143:0};a.O.j=function(t){return 0===e[t]};var t=function(t,n){var o,s,i=n[0],l=n[1],r=n[2],c=0;if(i.some((function(t){return 0!==e[t]}))){for(o in l)a.o(l,o)&&(a.m[o]=l[o]);if(r)var d=r(a)}for(t&&t(n);c<i.length;c++)s=i[c],a.o(e,s)&&e[s]&&e[s][0](),e[s]=0;return a.O(d)},n=self["webpackChunkcovid_19_ts"]=self["webpackChunkcovid_19_ts"]||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))}();var n=a.O(void 0,[998],(function(){return a(9746)}));n=a.O(n)})();
//# sourceMappingURL=app.dc8c8528.js.map
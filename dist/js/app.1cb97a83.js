(function(){"use strict";var e={4047:function(e,t,n){var a=n(8935),o=n(4549),i=n.n(o),l=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"app",attrs:{id:"app"}},[n("peoples-tree",{staticClass:"app__tree",attrs:{peoples:e.peoples,loading:e.loading},on:{change:e.handleChange,click:e.handleNodeClick}}),n("a-map",{ref:"map",staticClass:"app__map",attrs:{points:e.points}})],1)},r=[],s=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{ref:"amap",staticClass:"a-map"})},c=[],p=n(9648),u=n.n(p),d={name:"AMap",data(){return{map:null,cluster:null,AMap:null}},props:{points:{type:Array,default:()=>[]}},mounted(){this.initMap()},watch:{points(e){const t=[];e.forEach((e=>{e.location?t.push({id:e.id,lnglat:[e.location.lng,e.location.lat]}):console.log(e.id,e.name)})),this.cluster&&this.cluster.setMap(null),this.cluster=new this.AMap.MarkerCluster(this.map,t,{gridSize:60}),this.map.setFitView(null,!0)}},methods:{initMap(){const e=this.$refs.amap;u().load({key:"d786ac93724ce3d6658748d66cf5be5b",version:"2.0",plugins:["AMap.MarkerCluster","AMap.AutoComplete"]}).then((t=>{this.AMap=t,this.map=new t.Map(e,{viewMode:"2D",zoom:10,center:[118.144541,39.696604]})})).catch((e=>{console.log(e)}))},searchPoint(e){const t={city:"唐山市"},n=new this.AMap.AutoComplete(t);return new Promise(((t,a)=>{n.search(e.name,((n,o)=>{if("OK"===o.info){const{district:n,name:a,location:i}=o.tips[0],l={id:e.id,origin:e.name,district:n,name:a,location:{lng:i.lng,lat:i.lat}};t(l)}else a("err")}))}))},setCenter({location:e}){this.map.setZoomAndCenter(17,[e.lng,e.lat],!0)}}},h=d,f=n(1001),m=(0,f.Z)(h,s,c,!1,null,"1c41bc72",null),g=m.exports,v=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-tree",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"peoples-tree",attrs:{"node-key":"id","show-checkbox":"",data:e.treeData,props:e.defaultProps},on:{check:e.handleCheck,"node-click":e.handleClick},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.node,o=t.data;return n("span",{staticClass:"peoples-tree__label",class:{accurate0:3===a.level&&!o.accurate,accurate1:3===a.level&&1===o.accurate,accurate2:3===a.level&&2===o.accurate}},[e._v(" "+e._s(o.label)+" ")])}}])})},b=[],y={name:"PeoplesTree",data(){return{data:[],defaultProps:{label:"label",children:"children"}}},props:{peoples:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1}},computed:{treeData(){const e=[],t=[];return this.peoples.forEach((n=>{const a=n.id.slice(0,1),o=n.id.slice(1);let i;i="Q"===a?e:t;const l=n.track.map(((e,t)=>{let a;return a=e instanceof Object?{id:`${n.id}-${t}`,label:e.name,...e}:{id:`${n.id}-${t}`,label:e,name:e},a}));i.push({id:n.id,no:+o,label:`${o} ${n.area} (${l.length})`,children:l})})),e.sort(((e,t)=>e.no-t.no)),t.sort(((e,t)=>e.no-t.no)),[{id:"q",label:`确诊 [${e.length}]`,children:e},{id:"w",label:`无症状 [${t.length}]`,children:t}]}},methods:{handleCheck(e,{checkedNodes:t}){const n=t.filter((e=>!e.children));this.$emit("change",n)},handleClick(e){e.location&&this.$emit("click",e)}}},k=y,C=(0,f.Z)(k,v,b,!1,null,"7d7f0036",null),w=C.exports,_=n(6166),M=n.n(_);const A=M().create({timeout:3e3});var O=A,$={name:"App",components:{PeoplesTree:w,AMap:g},data(){return{peoples:[],points:[],AMap:null,loading:!1}},created(){u().load({key:"d786ac93724ce3d6658748d66cf5be5b",version:"2.0",plugins:["AMap.AutoComplete"]}).then((e=>{this.AMap=e,this.loadData()})).catch((e=>{console.log(e)}))},methods:{loadData(){this.loading=!0,O.get("data/data.json").then((({data:e})=>{const t=[];e.peoples.forEach((e=>{e.track.forEach(((n,a)=>{n.location||t.push(this.searchPoint(e,a,n))}))})),Promise.all(t).then((t=>{t.forEach((({people:e,index:t,pos:n})=>{e.track[t]=n})),this.peoples=e.peoples,this.loading=!1})).catch((e=>{console.log("err",e)}))}))},handleChange(e){this.points=e},handleNodeClick(e){const t=JSON.stringify({district:e.district,name:e.name,origin:e.origin,location:e.location,accurate:2});console.log(t),this.$refs.map.setCenter(e)},searchPoint(e,t,n){const a={city:"唐山市"};return new Promise(((o,i)=>{const l=new this.AMap.AutoComplete(a);l.search(n,((a,l)=>{if(l){let a;if("OK"===l.info){const{district:e,name:t,location:o}=l.tips[0];a={origin:n,district:e,name:t,location:{lng:o.lng,lat:o.lat},accurate:1}}else a={origin:n,name:n};o({people:e,index:t,pos:a})}else i({status:a,result:l,keywords:n})}))}))}}},P=$,x=(0,f.Z)(P,l,r,!1,null,null,null),j=x.exports;window._AMapSecurityConfig={securityJsCode:"30eb50807133bec74365efaac53b226a"},a["default"].use(i()),a["default"].config.productionTip=!1,new a["default"]({render:e=>e(j)}).$mount("#app")}},t={};function n(a){var o=t[a];if(void 0!==o)return o.exports;var i=t[a]={exports:{}};return e[a].call(i.exports,i,i.exports,n),i.exports}n.m=e,function(){var e=[];n.O=function(t,a,o,i){if(!a){var l=1/0;for(p=0;p<e.length;p++){a=e[p][0],o=e[p][1],i=e[p][2];for(var r=!0,s=0;s<a.length;s++)(!1&i||l>=i)&&Object.keys(n.O).every((function(e){return n.O[e](a[s])}))?a.splice(s--,1):(r=!1,i<l&&(l=i));if(r){e.splice(p--,1);var c=o();void 0!==c&&(t=c)}}return t}i=i||0;for(var p=e.length;p>0&&e[p-1][2]>i;p--)e[p]=e[p-1];e[p]=[a,o,i]}}(),function(){n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,{a:t}),t}}(),function(){n.d=function(e,t){for(var a in t)n.o(t,a)&&!n.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={143:0};n.O.j=function(t){return 0===e[t]};var t=function(t,a){var o,i,l=a[0],r=a[1],s=a[2],c=0;if(l.some((function(t){return 0!==e[t]}))){for(o in r)n.o(r,o)&&(n.m[o]=r[o]);if(s)var p=s(n)}for(t&&t(a);c<l.length;c++)i=l[c],n.o(e,i)&&e[i]&&e[i][0](),e[i]=0;return n.O(p)},a=self["webpackChunkcovid_19_ts"]=self["webpackChunkcovid_19_ts"]||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))}();var a=n.O(void 0,[998],(function(){return n(4047)}));a=n.O(a)})();
//# sourceMappingURL=app.1cb97a83.js.map
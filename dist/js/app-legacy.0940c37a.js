(function(){"use strict";var e={9905:function(e,t,n){n(6992),n(8674),n(9601),n(7727);var a=n(9567),o=n(4549),i=n.n(o),r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"app",attrs:{id:"app"}},[n("peoples-tree",{ref:"tree",staticClass:"app__tree",attrs:{peoples:e.peoples,expanded:e.expanded,loading:e.loading,"max-index":e.maxIndex},on:{change:e.handleChange,click:e.handleNodeClick}}),n("div",{staticClass:"app__main"},[n("div",{staticClass:"app__filter"},[e._l(e.options.areas,(function(t,a){return n("el-checkbox",{key:"a-"+a,on:{change:e.handleAreaChange},model:{value:t.checked,callback:function(n){e.$set(t,"checked",n)},expression:"area.checked"}},[e._v(e._s(t.label)+" ("+e._s(t.countQ)+"+"+e._s(t.countW)+") ")])})),e._l(e.options.dates,(function(t,a){return n("el-checkbox",{key:"d-"+a,on:{change:e.handleDateChange},model:{value:t.checked,callback:function(n){e.$set(t,"checked",n)},expression:"date.checked"}},[e._v(e._s(t.label)+" ("+e._s(t.countQ)+"+"+e._s(t.countW)+") ")])}))],2),n("a-map",{ref:"map",staticClass:"app__map",attrs:{points:e.points},on:{click:e.handleMarkerClick}})],1)],1)},c=[],l=n(3019),s=(n(1539),n(1249),n(7042),n(9826),n(2222),n(8783),n(3948),n(4747),n(8309),n(7327),n(4916),n(4765),function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"a-map"},[n("div",{ref:"amap",staticClass:"a-map__map"}),n("div",{ref:"marker",staticClass:"a-map__marker"},[n("p",[e._v(e._s(e.current.id))]),n("p",[e._v(e._s(e.current.title))])])])}),u=[],d=n(9648),p=n.n(d),f={name:"AMap",data:function(){return{map:null,cluster:null,AMap:null,infoWindow:null,current:{id:"",title:""}}},props:{points:{type:Array,default:function(){return[]}}},mounted:function(){this.initMap()},watch:{points:function(e){var t=this,n=[];e.forEach((function(e){e.location?n.push({id:e.id,title:e.origin,lnglat:[e.location.lng,e.location.lat]}):console.log(e.id,e.origin)})),this.cluster&&this.cluster.setMap(null),this.cluster=new this.AMap.MarkerCluster(this.map,n,{gridSize:60}),this.cluster.on("click",(function(e){var n=e.clusterData,a=e.lnglat,o=n[0],i=o.id,r=o.title;t.current.id=i,t.current.title=r,t.infoWindow.open(t.map,a),t.$emit("click",{id:i,title:r})})),this.map.setFitView(null,!0),this.infoWindow.close()}},methods:{initMap:function(){var e=this,t=this.$refs.amap;p().load({key:"d786ac93724ce3d6658748d66cf5be5b",version:"2.0",plugins:["AMap.MarkerCluster","AMap.AutoComplete"]}).then((function(n){e.AMap=n,e.map=new n.Map(t,{viewMode:"2D",zoom:10,center:[118.144541,39.696604]});var a=e.$refs.marker;e.infoWindow=new n.InfoWindow({anchor:"top-left",content:a})})).catch((function(e){console.log(e)}))},searchPoint:function(e){var t={city:"唐山市"},n=new this.AMap.AutoComplete(t);return new Promise((function(t,a){n.search(e.name,(function(n,o){if("OK"===o.info){var i=o.tips[0],r=i.district,c=i.name,l=i.location,s={id:e.id,origin:e.name,district:r,name:c,location:{lng:l.lng,lat:l.lat}};t(s)}else a("err")}))}))},setCenter:function(e){var t=e.location;this.map.setZoomAndCenter(17,[t.lng,t.lat],!0)}}},h=f,m=n(3736),v=(0,m.Z)(h,s,u,!1,null,"4908f708",null),g=v.exports,k=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-tree",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"tree",staticClass:"peoples-tree",attrs:{"node-key":"id","default-expanded-keys":e.expanded,"show-checkbox":"",data:e.treeData,props:e.defaultProps},on:{check:e.handleCheck,"node-click":e.handleClick,"node-contextmenu":e.handleContextmenu},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.node,o=t.data;return n("span",{staticClass:"peoples-tree__label",class:{accurate0:3===a.level&&!o.accurate,accurate1:3===a.level&&1===o.accurate,accurate2:3===a.level&&2===o.accurate}},[e._v(" "+e._s(o.label)+" "),o.date?n("span",{staticClass:"peoples-tree__date"},[e._v(e._s(o.date))]):e._e()])}}])})},_=[],b=(n(9653),n(2707),n(8862),{name:"PeoplesTree",data:function(){return{data:[],defaultProps:{label:"label",children:"children"},rid:0}},props:{peoples:{type:Array,default:function(){return[]}},loading:{type:Boolean,default:!1},expanded:{type:Array,default:function(){return[]}},maxIndex:{type:Number,default:0}},computed:{treeData:function(){var e=[],t=[];return this.peoples.forEach((function(n){var a,o=n.id.slice(0,1),i=n.id.slice(1);a="Q"===o?e:t;var r=n.track.map((function(e){return(0,l.Z)({label:e.origin||e.name},e)}));a.push({id:n.id,no:+i,label:"".concat(i," ").concat(n.area," (").concat(r.length,")"),date:n.date,children:r})})),e.sort((function(e,t){return e.no-t.no})),t.sort((function(e,t){return e.no-t.no})),[{id:"q",label:"确诊 [".concat(e.length,"]"),children:e},{id:"w",label:"无症状 [".concat(t.length,"]"),children:t}]}},watch:{maxIndex:function(e){this.rid=e}},methods:{handleCheck:function(e,t){var n=t.checkedNodes,a=n.filter((function(e){return!e.children}));this.$emit("change",a)},handleClick:function(e){e.location&&this.$emit("click",e)},handleContextmenu:function(e,t){if(t.location){var n=JSON.stringify({rid:++this.rid,district:t.district,name:t.name,location:t.location});console.log(n)}},checkAreas:function(e){var t=[];this.peoples.forEach((function(n){e.some((function(e){return e===n.area}))&&t.push(n.id)}));var n=this.$refs.tree;n.setCheckedKeys(t);var a=n.getCheckedNodes();this.handleCheck(null,{checkedNodes:a})}}}),C=b,x=(0,m.Z)(C,k,_,!1,null,"70a23761",null),y=x.exports,w=n(6166),A=n.n(w),M=A().create({timeout:3e5}),P=M,O={name:"App",components:{PeoplesTree:y,AMap:g},data:function(){return{allPeoples:[],peoples:[],points:[],AMap:null,loading:!1,expanded:[],maxIndex:0,options:{areas:[],dates:[]},areas:[],dates:[]}},created:function(){var e=this;p().load({key:"d786ac93724ce3d6658748d66cf5be5b",version:"2.0",plugins:["AMap.AutoComplete"]}).then((function(t){e.AMap=t,e.loadData()})).catch((function(e){console.log(e)}))},methods:{loadData:function(){var e=this;this.loading=!0,P.get("data/data.json").then((function(t){var n=t.data,a=[];e.maxIndex=n.positions.reduce((function(e,t){return e.rid>t.rid?e.rid:t.rid}));var o=n.peoples.map((function(t){var o=t.id.slice(0,1),i=e.options.areas.find((function(e){return e.label===t.area}));i?i["count".concat(o)]++:(i={label:t.area,checked:!0,countQ:0,countW:0},i["count".concat(o)]=1,e.options.areas.push(i)),e.areas=e.options.areas.map((function(e){return e.label}));var r=e.options.dates.find((function(e){return e.label===t.date}));r?r["count".concat(o)]++:(r={label:t.date,checked:!0,countQ:0,countW:0},r["count".concat(o)]=1,e.options.dates.push(r)),e.dates=e.options.dates.map((function(e){return e.label}));var c=t.track.map((function(o,i){var r;return o.rid?r=(0,l.Z)((0,l.Z)({},o),n.positions.find((function(e){return e.rid===o.rid}))):(r=(0,l.Z)({},o),0!==o.accurate&&a.push(e.searchPoint(r))),r.id="".concat(t.id,"-").concat(i),r}));return(0,l.Z)((0,l.Z)({},t),{},{track:c})}));Promise.all(a).then((function(t){t.forEach((function(e){var t=e.data,n=e.pos;t.district=n.district,t.name=n.name,t.location=n.location,t.accurate=n.accurate})),e.allPeoples=o,e.peoples=o,e.loading=!1})).catch((function(e){console.log("err",e)}))}))},handleChange:function(e){this.points=e},handleNodeClick:function(e){this.$refs.map.setCenter(e)},handleMarkerClick:function(e){this.expanded=[e.id.slice(0,5)]},handleAreaChange:function(){var e=[];this.options.areas.forEach((function(t){t.checked&&e.push(t.label)})),this.areas=e,this.filterPeoples()},handleDateChange:function(){var e=[];this.options.dates.forEach((function(t){t.checked&&e.push(t.label)})),this.dates=e,this.filterPeoples()},filterPeoples:function(){var e=this;this.peoples=this.allPeoples.filter((function(t){var n=t.date,a=t.area,o=e.dates.some((function(e){return e===n})),i=e.areas.some((function(e){return e===a}));return o&&i}))},searchPoint:function(e){var t=this,n={city:"唐山市"};return new Promise((function(a,o){var i=new t.AMap.AutoComplete(n);i.search(e.origin,(function(t,n){if(n){var i;if("OK"===n.info){var r=n.tips[0],c=r.district,l=r.name,s=r.location;i={district:c,name:l,location:{lng:s.lng,lat:s.lat},accurate:1}}else i={accurate:0};a({data:e,pos:i})}else o({status:t,result:n,origin:e.origin})}))}))}}},$=O,E=(0,m.Z)($,r,c,!1,null,null,null),Z=E.exports;window._AMapSecurityConfig={securityJsCode:"30eb50807133bec74365efaac53b226a"},a["default"].use(i()),a["default"].config.productionTip=!1,new a["default"]({render:function(e){return e(Z)}}).$mount("#app")}},t={};function n(a){var o=t[a];if(void 0!==o)return o.exports;var i=t[a]={exports:{}};return e[a].call(i.exports,i,i.exports,n),i.exports}n.m=e,function(){var e=[];n.O=function(t,a,o,i){if(!a){var r=1/0;for(u=0;u<e.length;u++){a=e[u][0],o=e[u][1],i=e[u][2];for(var c=!0,l=0;l<a.length;l++)(!1&i||r>=i)&&Object.keys(n.O).every((function(e){return n.O[e](a[l])}))?a.splice(l--,1):(c=!1,i<r&&(r=i));if(c){e.splice(u--,1);var s=o();void 0!==s&&(t=s)}}return t}i=i||0;for(var u=e.length;u>0&&e[u-1][2]>i;u--)e[u]=e[u-1];e[u]=[a,o,i]}}(),function(){n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,{a:t}),t}}(),function(){n.d=function(e,t){for(var a in t)n.o(t,a)&&!n.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={143:0};n.O.j=function(t){return 0===e[t]};var t=function(t,a){var o,i,r=a[0],c=a[1],l=a[2],s=0;if(r.some((function(t){return 0!==e[t]}))){for(o in c)n.o(c,o)&&(n.m[o]=c[o]);if(l)var u=l(n)}for(t&&t(a);s<r.length;s++)i=r[s],n.o(e,i)&&e[i]&&e[i][0](),e[i]=0;return n.O(u)},a=self["webpackChunkcovid_19_ts"]=self["webpackChunkcovid_19_ts"]||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))}();var a=n.O(void 0,[998],(function(){return n(9905)}));a=n.O(a)})();
//# sourceMappingURL=app-legacy.0940c37a.js.map
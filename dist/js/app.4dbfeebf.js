(function(){"use strict";var e={9905:function(e,t,a){var n=a(8935),i=a(4549),o=a.n(i),s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app",attrs:{id:"app"}},[a("peoples-tree",{ref:"tree",staticClass:"app__tree",attrs:{peoples:e.peoples,expanded:e.expanded,loading:e.loading,"max-index":e.maxIndex},on:{change:e.handleChange,click:e.handleNodeClick}}),a("div",{staticClass:"app__main"},[a("div",{staticClass:"app__filter"},[e._l(e.options.areas,(function(t,n){return a("el-checkbox",{key:"a-"+n,on:{change:e.handleAreaChange},model:{value:t.checked,callback:function(a){e.$set(t,"checked",a)},expression:"area.checked"}},[e._v(e._s(t.label)+" ("+e._s(t.countQ)+"+"+e._s(t.countW)+") ")])})),e._l(e.options.dates,(function(t,n){return a("el-checkbox",{key:"d-"+n,on:{change:e.handleDateChange},model:{value:t.checked,callback:function(a){e.$set(t,"checked",a)},expression:"date.checked"}},[e._v(e._s(t.label)+" ("+e._s(t.countQ)+"+"+e._s(t.countW)+") ")])}))],2),a("a-map",{ref:"map",staticClass:"app__map",attrs:{points:e.points},on:{click:e.handleMarkerClick}})],1)],1)},l=[],r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"a-map"},[a("div",{ref:"amap",staticClass:"a-map__map"}),a("div",{ref:"marker",staticClass:"a-map__marker"},[a("p",[e._v(e._s(e.current.id))]),a("p",[e._v(e._s(e.current.title))])])])},c=[],d=a(9648),p=a.n(d),u={name:"AMap",data(){return{map:null,cluster:null,AMap:null,infoWindow:null,current:{id:"",title:""}}},props:{points:{type:Array,default:()=>[]}},mounted(){this.initMap()},watch:{points(e){const t=[];e.forEach((e=>{e.location?t.push({id:e.id,title:e.origin,lnglat:[e.location.lng,e.location.lat]}):console.log(e.id,e.origin)})),this.cluster&&this.cluster.setMap(null),this.cluster=new this.AMap.MarkerCluster(this.map,t,{gridSize:60}),this.cluster.on("click",(({clusterData:e,lnglat:t})=>{const{id:a,title:n}=e[0];this.current.id=a,this.current.title=n,this.infoWindow.open(this.map,t),this.$emit("click",{id:a,title:n})})),this.map.setFitView(null,!0),this.infoWindow.close()}},methods:{initMap(){const e=this.$refs.amap;p().load({key:"d786ac93724ce3d6658748d66cf5be5b",version:"2.0",plugins:["AMap.MarkerCluster","AMap.AutoComplete"]}).then((t=>{this.AMap=t,this.map=new t.Map(e,{viewMode:"2D",zoom:10,center:[118.144541,39.696604]});const a=this.$refs.marker;this.infoWindow=new t.InfoWindow({anchor:"top-left",content:a})})).catch((e=>{console.log(e)}))},searchPoint(e){const t={city:"唐山市"},a=new this.AMap.AutoComplete(t);return new Promise(((t,n)=>{a.search(e.name,((a,i)=>{if("OK"===i.info){const{district:a,name:n,location:o}=i.tips[0],s={id:e.id,origin:e.name,district:a,name:n,location:{lng:o.lng,lat:o.lat}};t(s)}else n("err")}))}))},setCenter({location:e}){this.map.setZoomAndCenter(17,[e.lng,e.lat],!0)}}},h=u,f=a(3736),m=(0,f.Z)(h,r,c,!1,null,"4908f708",null),g=m.exports,k=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-tree",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"tree",staticClass:"peoples-tree",attrs:{"node-key":"id","default-expanded-keys":e.expanded,"show-checkbox":"",data:e.treeData,props:e.defaultProps},on:{check:e.handleCheck,"node-click":e.handleClick,"node-contextmenu":e.handleContextmenu},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.node,i=t.data;return a("span",{staticClass:"peoples-tree__label",class:{accurate0:3===n.level&&!i.accurate,accurate1:3===n.level&&1===i.accurate,accurate2:3===n.level&&2===i.accurate}},[e._v(" "+e._s(i.label)+" "),i.date?a("span",{staticClass:"peoples-tree__date"},[e._v(e._s(i.date))]):e._e()])}}])})},v=[],_={name:"PeoplesTree",data(){return{data:[],defaultProps:{label:"label",children:"children"},rid:0}},props:{peoples:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1},expanded:{type:Array,default:()=>[]},maxIndex:{type:Number,default:0}},computed:{treeData(){const e=[],t=[];return this.peoples.forEach((a=>{const n=a.id.slice(0,1),i=a.id.slice(1);let o;o="Q"===n?e:t;const s=a.track.map((e=>({label:e.origin||e.name,...e})));o.push({id:a.id,no:+i,label:`${i} ${a.area} (${s.length})`,date:a.date,children:s})})),e.sort(((e,t)=>e.no-t.no)),t.sort(((e,t)=>e.no-t.no)),[{id:"q",label:`确诊 [${e.length}]`,children:e},{id:"w",label:`无症状 [${t.length}]`,children:t}]}},watch:{maxIndex(e){this.rid=e}},methods:{handleCheck(e,{checkedNodes:t}){const a=t.filter((e=>!e.children));this.$emit("change",a)},handleClick(e){e.location&&this.$emit("click",e)},handleContextmenu(e,t){if(t.location){const e=JSON.stringify({rid:++this.rid,district:t.district,name:t.name,location:t.location});console.log(e)}},checkAreas(e){const t=[];this.peoples.forEach((a=>{e.some((e=>e===a.area))&&t.push(a.id)}));const a=this.$refs.tree;a.setCheckedKeys(t);const n=a.getCheckedNodes();this.handleCheck(null,{checkedNodes:n})}}},b=_,C=(0,f.Z)(b,k,v,!1,null,"70a23761",null),x=C.exports,y=a(6166),w=a.n(y);const A=w().create({timeout:3e5});var M=A,$={name:"App",components:{PeoplesTree:x,AMap:g},data(){return{allPeoples:[],peoples:[],points:[],AMap:null,loading:!1,expanded:[],maxIndex:0,options:{areas:[],dates:[]},areas:[],dates:[]}},created(){p().load({key:"d786ac93724ce3d6658748d66cf5be5b",version:"2.0",plugins:["AMap.AutoComplete"]}).then((e=>{this.AMap=e,this.loadData()})).catch((e=>{console.log(e)}))},methods:{loadData(){this.loading=!0,M.get("data/data.json").then((({data:e})=>{const t=[];this.maxIndex=e.positions.reduce(((e,t)=>e.rid>t.rid?e.rid:t.rid));const a=e.peoples.map((a=>{const n=a.id.slice(0,1);let i=this.options.areas.find((e=>e.label===a.area));i?i[`count${n}`]++:(i={label:a.area,checked:!0,countQ:0,countW:0},i[`count${n}`]=1,this.options.areas.push(i)),this.areas=this.options.areas.map((e=>e.label));let o=this.options.dates.find((e=>e.label===a.date));o?o[`count${n}`]++:(o={label:a.date,checked:!0,countQ:0,countW:0},o[`count${n}`]=1,this.options.dates.push(o)),this.dates=this.options.dates.map((e=>e.label));const s=a.track.map(((n,i)=>{let o;return n.rid?o={...n,...e.positions.find((e=>e.rid===n.rid))}:(o={...n},0!==n.accurate&&t.push(this.searchPoint(o))),o.id=`${a.id}-${i}`,o}));return{...a,track:s}}));Promise.all(t).then((e=>{e.forEach((({data:e,pos:t})=>{e.district=t.district,e.name=t.name,e.location=t.location,e.accurate=t.accurate})),this.allPeoples=a,this.peoples=a,this.loading=!1})).catch((e=>{console.log("err",e)}))}))},handleChange(e){this.points=e},handleNodeClick(e){this.$refs.map.setCenter(e)},handleMarkerClick(e){this.expanded=[e.id.slice(0,5)]},handleAreaChange(){let e=[];this.options.areas.forEach((t=>{t.checked&&e.push(t.label)})),this.areas=e,this.filterPeoples()},handleDateChange(){let e=[];this.options.dates.forEach((t=>{t.checked&&e.push(t.label)})),this.dates=e,this.filterPeoples()},filterPeoples(){this.peoples=this.allPeoples.filter((e=>{const{date:t,area:a}=e,n=this.dates.some((e=>e===t)),i=this.areas.some((e=>e===a));return n&&i}))},searchPoint(e){const t={city:"唐山市"};return new Promise(((a,n)=>{const i=new this.AMap.AutoComplete(t);i.search(e.origin,((t,i)=>{if(i){let t;if("OK"===i.info){const{district:e,name:a,location:n}=i.tips[0];t={district:e,name:a,location:{lng:n.lng,lat:n.lat},accurate:1}}else t={accurate:0};a({data:e,pos:t})}else n({status:t,result:i,origin:e.origin})}))}))}}},P=$,O=(0,f.Z)(P,s,l,!1,null,null,null),E=O.exports;window._AMapSecurityConfig={securityJsCode:"30eb50807133bec74365efaac53b226a"},n["default"].use(o()),n["default"].config.productionTip=!1,new n["default"]({render:e=>e(E)}).$mount("#app")}},t={};function a(n){var i=t[n];if(void 0!==i)return i.exports;var o=t[n]={exports:{}};return e[n].call(o.exports,o,o.exports,a),o.exports}a.m=e,function(){var e=[];a.O=function(t,n,i,o){if(!n){var s=1/0;for(d=0;d<e.length;d++){n=e[d][0],i=e[d][1],o=e[d][2];for(var l=!0,r=0;r<n.length;r++)(!1&o||s>=o)&&Object.keys(a.O).every((function(e){return a.O[e](n[r])}))?n.splice(r--,1):(l=!1,o<s&&(s=o));if(l){e.splice(d--,1);var c=i();void 0!==c&&(t=c)}}return t}o=o||0;for(var d=e.length;d>0&&e[d-1][2]>o;d--)e[d]=e[d-1];e[d]=[n,i,o]}}(),function(){a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,{a:t}),t}}(),function(){a.d=function(e,t){for(var n in t)a.o(t,n)&&!a.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}}(),function(){a.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={143:0};a.O.j=function(t){return 0===e[t]};var t=function(t,n){var i,o,s=n[0],l=n[1],r=n[2],c=0;if(s.some((function(t){return 0!==e[t]}))){for(i in l)a.o(l,i)&&(a.m[i]=l[i]);if(r)var d=r(a)}for(t&&t(n);c<s.length;c++)o=s[c],a.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return a.O(d)},n=self["webpackChunkcovid_19_ts"]=self["webpackChunkcovid_19_ts"]||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))}();var n=a.O(void 0,[998],(function(){return a(9905)}));n=a.O(n)})();
//# sourceMappingURL=app.4dbfeebf.js.map